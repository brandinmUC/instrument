<style>
  input{
    width: 650px
  }
</style>
<body></body>
<script src="https://unpkg.com/tone"></script>
<script src="https://cdn.jsdelivr.net/gh/netizenorg/netnet-standard-library/build/nn.min.js?v=1"></script>
<script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
<script src="https://algorithmicmusic.online/js/create-spectrum.js"></script>
<script src="https://algorithmicmusic.online/js/create-waveform.js"></script>
<script>
/* global Tone, nn, d3, createWaveform, createSpectrum */
  
// const effect = new Tone.Tremolo().start()  
const effect = new Tone.BitCrusher()
const sound = "https://upload.wikimedia.org/wikipedia/commons/d/dc/Scream-c.wav"
const player = new Tone.Player(sound)
player.connect(effect)
player.loop = true
effect.toDestination()
  
function changeRate (e = 1){
  const rate = Number(e.target.value)
  console.log(rate)
  player.playbackRate = rate
}

function changeAttribute(e = 1){
  const val = Number(e.target.value)
  console.log(val)
  effect.set({bits: val})
}
  
function togglePlayer(e){
  if (e.target.checked){
     player.start()
  }
  else{
    player.stop()
  }
}  

 
function resetSettings(e){
  const rate = document.getElementById("rate");
  const attribute = document.getElementById("attribute");
  rate.value = 1; // Set to default value
  changeRate();
  attribute.value = 1;
  changeAttribute(); 
}
  
  
// UI (to trigger play function)
nn.create('input') //rate
  .set({
    type: 'range',
    min: 0, // minimum value for this slider
    max: 3, // maximum value for this range
    value: 1, // default value
    step: 0.01, // smallest change we can make when we slide it
    id: "rate"
  })
  .addTo('body')
  .on('input', changeRate)
  
nn.create('input') //Tremolo
  .set({
    type: 'range',
    min: 1, // minimum value for this slider
    max: 16, // maximum value for this range
    value: 1, // default value
    step: 1, // smallest change we can make when we slide it
    id: "attribute"
  })
  .addTo('body')
  .on('input', changeAttribute)
  
nn.create('input')
  .set({ type: 'checkbox' })
  .content('play sound')
  .addTo('body')
  .on('change', togglePlayer)
  
nn.create('button')     // what we want to make
  .content('Reset') // what we want it to say
  .addTo('body')       // where we want to put it
  .on('click', resetSettings)


// visualizations
const spec = createSpectrum({ range: [0, 8000] })
effect.connect(spec)

</script>