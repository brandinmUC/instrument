<style>
  input{
    width: 600px
  }
</style>
<body></body>
<script src="https://unpkg.com/tone"></script>
<script src="https://cdn.jsdelivr.net/gh/netizenorg/netnet-standard-library/build/nn.min.js?v=1"></script>
<script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
<script src="https://algorithmicmusic.online/js/create-spectrum.js"></script>
<script src="https://algorithmicmusic.online/js/create-waveform.js"></script>
<script>

// document.body.style.background = "black"
// document.body.s
 //screaming "https://upload.wikimedia.org/wikipedia/commons/d/dc/Scream-c.wav" 
//Default Sounds (add file drop later) 
const sound1 = 
"https://upload.wikimedia.org/wikipedia/commons/5/56/ZappBeats_808.wav"
const sound2 = "https://upload.wikimedia.org/wikipedia/commons/d/df/Hunting_horn_tone.ogg"


//Initalize the two channels
const player1 = new Tone.Player(sound1)
const player2 = new Tone.Player(sound2)

  
// Initalize the two effects
const effect1 = new Tone.BitCrusher()
const effect2 = new Tone.Chorus().start()

// Make cinnections
player1.connect(effect1)
player2.connect(effect2)
player1.loop = true
player2.loop = true
effect1.toDestination()
effect2.toDestination()
 
  
function changeRate(e){
  const rate = Number(e.target.value)
  console.log("RATE:", rate);
  rlabel.content("Rate: " + rate);
  player1.playbackRate = player2.playbackRate = rate;
}


function changeVolume(e){
  const vol = Number(e.target.value);
  console.log("VOL: " + vol);
  vlabel.content("Volume: " + (vol + 22));
  player1.volume.value = player2.volume.value = vol;
}
  

function changeBits(e){
  const val = Number(e.target.value)
  console.log("BITS", val)
  blabel.content("Bits: " + val);
  effect1.set({bits: val})
}
  

function changeChorus (e){
  const val = Number(e.target.value)
  effect2.set({
    frequency: 4, 
    delayTime: 16, 
    // type: 'triangle', 
    depth: 1, 
    feedback: 0.1, 
    spread: 120,
    wet: e.target.value})
  clabel.content("Chorus (wet): " + val);
}
  
  
function togglePlayer1(e){
  if (e.target.checked){
     player1.start();
  }
  else{
    player1.stop();
  }
}  

  
function togglePlayer2(e){
  if (e.target.checked){
     player2.start();
  }
  else{
    player2.stop();
  }
}   
  
  
function resetSettings1(e){
  const rate = document.getElementById("rate");
  const attribute = document.getElementById("attribute");
  const volume = document.getElementById("volume");
  rate.value = player1.playbackRate = 1;
  volume.value = player1.volume.value = 0;
  // if bits
  attribute.value = 16; //idk about this yet
  effect1.set({bits: 16});  //idk about this yet
  rlabel.content("Rate: " + 1)
  vlabel.content("Volume: " + 22)
  blabel.content("Bits: " + 16)
}

  
function resetSettings2(e){
  const rate = document.getElementById("rate");
  const attribute = document.getElementById("attribute");
  const volume = document.getElementById("volume");
  rate.value = player1.playbackRate = player2.playbackRate = 1;
  volume.value = player1.volume.value = player2.volume.value = 0;
  // if bits
  attribute.value = 16; //idk about this yet
  effect2.set({wet: 0.5});  //idk about this yet
  rlabel.content("Rate: " + 1)
  vlabel.content("Volume: " + 22)
  blabel.content("Bits: " + 16)
}  
 
  
// UI (to trigger play function)
// Sliders
nn.create('input') //Rate
  .set({
    type: 'range',
    min: 0, // minimum value for this slider
    max: 3, // maximum value for this range
    value: 1, // default value
    step: 0.01, // smallest change we can make when we slide it
    id: "rate"
  })
  .addTo('body')
  .on('input', changeRate);
  
  
const rlabel = nn.create('label')
  .content('Rate: 1')
  .addTo('body');
  
  
nn.create('input') //Volume
  .set({
    type: 'range',
    min: -22, // minimum value for this slider
    max: 22, // maximum value for this range
    value: 0, // default value
    step: 1, // smallest change we can make when we slide it
    id: "volume"
  })
  .addTo('body')
  .on('input', changeVolume);
  
  
const vlabel = nn.create('label')
  .content('Volume: 22')
  .addTo('body');
  
  
nn.create('input') //Bits
  .set({
    type: 'range',
    min: 1, // minimum value for this slider
    max: 16, // maximum value for this range
    value: 16, // default value
    step: 1, // smallest change we can make when we slide it
    id: "attribute"
  })
  .addTo('body')
  .on('input', changeBits)

  
const blabel = nn.create('label')
  .content('Bits: 16')
  .addTo('body'); 

  
nn.create('input') //Bits
  .set({
    type: 'range',
    min: 0, // minimum value for this slider
    max: 1, // maximum value for this range
    value: 0, // default value
    step: 0.1, // smallest change we can make when we slide it
    id: "attribute"
  })
  .addTo('body')
  .on('input', changeChorus)
  
 
const clabel = nn.create('label')
  .content('Chorus: 0')
  .addTo('body'); 
  
  


  
// file selection
function loadFileToBuffer (file, channel) {
  // we'll use the FileReader API...
  const reader = new window.FileReader()

  // we'll setup the "onload" event listener,
  // to decode the audio data from the file's data
  // and apply it to the player's buffer
  reader.onload = async (e) => {
    const fileData = e.target.result
    const buffer = await Tone.context.decodeAudioData(fileData)
    if (channel === 1){
    player1.buffer = buffer
    clabel2.content('Channel 1: ' + file.name)
    } else {
      player2.buffer = buffer
      clabel3.content('Channel 2: ' + file.name)
    }
  }

  // we'll read the file and trigger the "onload" listener above
  reader.readAsArrayBuffer(file)
}

  
// visualizations
//CHANNEL 1
const spec1 = createSpectrum({ range: [0, 8000], color: "red" })
const clabel2 = nn.create('label')
  .content('Channel 1: ' + sound1)
  .addTo('body'); 
  
  
// Read file input - from example
nn.create('input')
  .set({ type: 'file', accept: 'audio/*' })
  .addTo('body')
  .on('change', () => {
    const file = event.target.files[0]
    if (file) loadFileToBuffer(file, 1)
  })
  

// Inputs
nn.create('input')
  .set({
    type: 'checkbox',
    id: "start/stop1"
  })
  .content('play sound')
  .addTo('body')
  .on('change', togglePlayer1);
  

nn.create('button')    // what we want to make
  .content('Reset Channel 1')    // what we want it to say
  .addTo('body')      // where we want to put it
  .on('click', resetSettings1);
 
// CHANNEL 2  
const spec2 = createSpectrum({ range: [0, 8000], color: "green" })
const clabel3 = nn.create('label')
  .content('Channel 2: ' + sound2)
  .addTo('body'); 
  
nn.create('input')
  .set({ type: 'file', accept: 'audio/*' })
  .addTo('body')
  .on('change', () => {
    const file = event.target.files[0]
    if (file) loadFileToBuffer(file, 2)
  })
  

nn.create('input')
  .set({
    type: 'checkbox',
    id: "start/stop2"
  })
  .content('play sound')
  .addTo('body')
  .on('change', togglePlayer2); 
  

nn.create('button')    // what we want to make
  .content('Reset Channel 2')    // what we want it to say
  .addTo('body')      // where we want to put it
  .on('click', resetSettings2);  
effect1.connect(spec1)
effect2.connect(spec2)


</script>