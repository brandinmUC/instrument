<style>
  input{
    width: 650px
  }
</style>
<body></body>
<script src="https://unpkg.com/tone"></script>
<script src="https://cdn.jsdelivr.net/gh/netizenorg/netnet-standard-library/build/nn.min.js?v=1"></script>
<script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
<script src="https://algorithmicmusic.online/js/create-spectrum.js"></script>
<script src="https://algorithmicmusic.online/js/create-waveform.js"></script>
<script>
  
  
/* global Tone, nn, d3, createWaveform, createSpectrum */
  
// const effect = new Tone.Tremolo().start()  
const effect = new Tone.BitCrusher()
const sound = "https://upload.wikimedia.org/wikipedia/commons/d/dc/Scream-c.wav"
// const sound = "https://www.myinstants.com/media/sounds/tuco-get-out.mp3"

const player = new Tone.Player(sound)

  
player.connect(effect)
player.loop = true
effect.toDestination()
 
  
function changeRate(e){
  const rate = Number(e.target.value)
  console.log("RATE:", rate);
  rlabel.content("Rate: " + rate);
  player.playbackRate = rate;
}


function changeVolume(e){
  const vol = Number(e.target.value);
  console.log("VOL: " + vol);
  vlabel.content("Volume: " + (vol + 22));
  player.volume.value = vol;
}
  

function changeAttribute(e){
  // if (val){
  //    console.log(val)
  //     effect.set({bits: val})
  // } else{
  const val = Number(e.target.value)
  console.log("BITS", val)
  alabel.content("Bits: " + val);
  effect.set({bits: val})
}
  
    
function togglePlayer(e){
  if (e.target.checked){
     player.start();
  }
  else{
    player.stop();
  }
}  

 
function resetSettings(e){
  const rate = document.getElementById("rate");
  const attribute = document.getElementById("attribute");
  const volume = document.getElementById("volume");
  rate.value = player.playbackRate = 1;
  volume.value = player.volume.value = 0;
  // if bits
  attribute.value = 16; //idk about this yet
  effect.set({bits: 16});  //idk about this yet
  rlabel.content("Rate: " + 1)
  vlabel.content("Volume: " + 22)
  alabel.content("Bits: " + 16)
}
  
  
// UI (to trigger play function)
// Sliders
nn.create('input') //Rate
  .set({
    type: 'range',
    min: 0, // minimum value for this slider
    max: 3, // maximum value for this range
    value: 1, // default value
    step: 0.01, // smallest change we can make when we slide it
    id: "rate"
  })
  .addTo('body')
  .on('input', changeRate);
  
  
const rlabel = nn.create('label')
  .content('Rate: 1')
  .addTo('body');
  
  
nn.create('input') //Volume
  .set({
    type: 'range',
    min: -22, // minimum value for this slider
    max: 22, // maximum value for this range
    value: 0, // default value
    step: 1, // smallest change we can make when we slide it
    id: "volume"
  })
  .addTo('body')
  .on('input', changeVolume);
  
  
const vlabel = nn.create('label')
  .content('Volume: 22')
  .addTo('body');
  
  
nn.create('input') //Bits
  .set({
    type: 'range',
    min: 1, // minimum value for this slider
    max: 16, // maximum value for this range
    value: 16, // default value
    step: 1, // smallest change we can make when we slide it
    id: "attribute"
  })
  .addTo('body')
  .on('input', changeAttribute)
  
const alabel = nn.create('label')
  .content('Bits: 16')
  .addTo('body');  
  
// Inputs
nn.create('input')
  .set({
    type: 'checkbox',
    id: "start/stop"
  })
  .content('play sound')
  .addTo('body')
  .on('change', togglePlayer);
  
  
nn.create('button')    // what we want to make
  .content('Reset')    // what we want it to say
  .addTo('body')      // where we want to put it
  .on('click', resetSettings);


// visualizations
const spec = createSpectrum({ range: [0, 8000] })
effect.connect(spec)

  
</script>